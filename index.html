<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tennis Ladder Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.22.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Simple icon components
        const Trophy = () => <span style={{fontSize: '24px'}}>🏆</span>;
        const Users = () => <span style={{fontSize: '24px'}}>👥</span>;
        const Settings = () => <span style={{fontSize: '24px'}}>⚙️</span>;
        const Target = () => <span style={{fontSize: '24px'}}>🎯</span>;
        const Crown = () => <span style={{fontSize: '24px'}}>👑</span>;
        const Mail = () => <span style={{fontSize: '24px'}}>📧</span>;
        const Star = () => <span style={{fontSize: '24px'}}>⭐</span>;
        const Clock = () => <span style={{fontSize: '24px'}}>⏰</span>;
        const Plus = () => <span style={{fontSize: '20px'}}>➕</span>;
        const Calendar = () => <span style={{fontSize: '24px'}}>📅</span>;

        const TennisLadderApp = () => {
            const [currentView, setCurrentView] = useState('login');
            const [currentUser, setCurrentUser] = useState(null);
            const [ladders, setLadders] = useState([]);
            const [selectedLadder, setSelectedLadder] = useState(null);
            const [players, setPlayers] = useState([]);
            const [challenges, setChallenges] = useState([]);
            const [matches, setMatches] = useState([]);

            // Initialize with sample data
            useEffect(() => {
                const sampleLadder = {
                    id: 1,
                    name: "Men's Challenge Ladder",
                    description: "Weekly men's singles ladder",
                    type: "Men's Singles",
                    rankingFormula: "Points-Based",
                    startDate: "2025-06-15",
                    allowJoining: true,
                    adminName: "Zach CARDAIS",
                    adminEmail: "zcardais@gmail.com",
                    settings: {
                        allowBackToBack: false,
                        allowLocationSpecify: false,
                        showUSTARatings: true,
                        allowOneSetMatches: false,
                        winSetAt: 6,
                        winSetBy: 2,
                        pointsAllPlayers: 2,
                        pointsWinSet: 1,
                        pointsWinMatch: 5,
                        pointsThreeSets: 2,
                        pointsStraightSets: 1
                    }
                };

                const samplePlayers = [
                    { id: 1, name: "John Smith", email: "john@email.com", ranking: 1, points: 85, matches: 6, wins: 5, losses: 1, active: true },
                    { id: 2, name: "Mike Johnson", email: "mike@email.com", ranking: 2, points: 78, matches: 5, wins: 4, losses: 1, active: true },
                    { id: 3, name: "David Wilson", email: "david@email.com", ranking: 3, points: 72, matches: 4, wins: 3, losses: 1, active: true },
                    { id: 4, name: "Tom Brown", email: "tom@email.com", ranking: 4, points: 65, matches: 4, wins: 2, losses: 2, active: true },
                    { id: 5, name: "Chris Davis", email: "chris@email.com", ranking: 5, points: 58, matches: 3, wins: 2, losses: 1, active: true },
                    { id: 6, name: "Steve Wilson", email: "steve@email.com", ranking: 6, points: 52, matches: 3, wins: 1, losses: 2, active: true },
                    { id: 7, name: "Mark Thompson", email: "mark@email.com", ranking: 7, points: 45, matches: 2, wins: 1, losses: 1, active: true },
                    { id: 8, name: "James Miller", email: "james@email.com", ranking: 8, points: 38, matches: 2, wins: 0, losses: 2, active: true }
                ];

                const sampleChallenges = [
                    { id: 1, challengerId: 4, challengedId: 2, status: 'pending', date: '2025-06-18', ladderid: 1 },
                    { id: 2, challengerId: 5, challengedId: 3, status: 'accepted', date: '2025-06-20', ladderid: 1 },
                    { id: 3, challengerId: 7, challengedId: 5, status: 'pending', date: '2025-06-19', ladderid: 1 }
                ];

                const sampleMatches = [
                    { 
                        id: 1, 
                        player1Id: 1, 
                        player2Id: 3, 
                        winnerId: 1, 
                        score: "6-4, 6-2",
                        sets: [{ p1: 6, p2: 4 }, { p1: 6, p2: 2 }],
                        date: '2025-06-10',
                        reportedBy: 1
                    },
                    { 
                        id: 2, 
                        player1Id: 2, 
                        player2Id: 4, 
                        winnerId: 2, 
                        score: "7-5, 4-6, 6-3",
                        sets: [{ p1: 7, p2: 5 }, { p1: 4, p2: 6 }, { p1: 6, p2: 3 }],
                        date: '2025-06-12',
                        reportedBy: 2
                    }
                ];

                setLadders([sampleLadder]);
                setSelectedLadder(sampleLadder);
                setPlayers(samplePlayers);
                setChallenges(sampleChallenges);
                setMatches(sampleMatches);
            }, []);

            const LoginScreen = () => (
                <div className="min-h-screen bg-gradient-to-br from-green-400 to-blue-500 flex items-center justify-center px-4">
                    <div className="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
                        <div className="text-center mb-8">
                            <div className="mx-auto h-12 w-12 text-green-600 mb-4 text-4xl">🏆</div>
                            <h1 className="text-2xl font-bold text-gray-900">Tennis Ladder Pro</h1>
                            <p className="text-gray-600 mt-2">Manage your tennis ladder with ease</p>
                        </div>
                        
                        <div className="space-y-4">
                            <button
                                onClick={() => {
                                    setCurrentUser({ id: 1, name: "Zach CARDAIS", email: "zcardais@gmail.com", role: "admin" });
                                    setCurrentView('admin-dashboard');
                                }}
                                className="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition duration-200 font-medium"
                            >
                                Login as Admin
                            </button>
                            
                            <button
                                onClick={() => {
                                    setCurrentUser({ id: 2, name: "Mike Johnson", email: "mike@email.com", role: "player" });
                                    setCurrentView('player-dashboard');
                                }}
                                className="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-200 font-medium"
                            >
                                Login as Player (Mike Johnson - Rank #2)
                            </button>
                            
                            <button
                                onClick={() => {
                                    setCurrentUser({ id: 7, name: "Mark Thompson", email: "mark@email.com", role: "player" });
                                    setCurrentView('player-dashboard');
                                }}
                                className="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition duration-200 font-medium"
                            >
                                Login as Player (Mark Thompson - Rank #7)
                            </button>
                            
                            <div className="text-center">
                                <button
                                    onClick={() => setCurrentView('register')}
                                    className="text-green-600 hover:text-green-700 font-medium"
                                >
                                    New Player? Register Here
                                </button>
                            </div>
                        </div>

                        <div className="mt-8 p-4 bg-gray-50 rounded-lg text-sm text-gray-600">
                            <h3 className="font-medium mb-2">Demo Instructions:</h3>
                            <ul className="space-y-1 text-xs">
                                <li>• Try logging in as Admin to see management features</li>
                                <li>• Try different players to see challenge options</li>
                                <li>• Test the challenge system between players</li>
                                <li>• View rankings and manage players</li>
                            </ul>
                        </div>
                    </div>
                </div>
            );

            const ReportScoreView = () => {
                const [scoreData, setScoreData] = useState({
                    sets: [
                        { p1: '', p2: '', p1Tiebreak: '', p2Tiebreak: '', isTenPointTiebreak: false }, 
                        { p1: '', p2: '', p1Tiebreak: '', p2Tiebreak: '', isTenPointTiebreak: false }, 
                        { p1: '', p2: '', p1Tiebreak: '', p2Tiebreak: '', isTenPointTiebreak: false }
                    ],
                    winnerId: null
                });

                const currentMatch = window.currentMatch || { player1Id: 2, player2Id: 5 }; // Default for testing
                const player1 = players.find(p => p.id === currentMatch.player1Id);
                const player2 = players.find(p => p.id === currentMatch.player2Id);

                const needsTiebreak = (p1Score, p2Score) => {
                    return (p1Score === 7 && p2Score === 6) || (p1Score === 6 && p2Score === 7);
                };

                const isTenPointTiebreakSet = (p1Score, p2Score) => {
                    return (p1Score === 1 && p2Score === 0) || (p1Score === 0 && p2Score === 1);
                };

                const calculateWinner = () => {
                    let p1Sets = 0;
                    let p2Sets = 0;
                    
                    scoreData.sets.forEach(set => {
                        if (set.p1 && set.p2) {
                            const p1Score = parseInt(set.p1);
                            const p2Score = parseInt(set.p2);
                            
                            if (set.isTenPointTiebreak) {
                                // 10-point tiebreak: winner is who has 1, loser has 0
                                if (p1Score === 1 && p2Score === 0) p1Sets++;
                                else if (p2Score === 1 && p1Score === 0) p2Sets++;
                            } else if (needsTiebreak(p1Score, p2Score)) {
                                // 7-6 or 6-7 set - check tiebreak winner
                                if (set.p1Tiebreak && set.p2Tiebreak) {
                                    const p1Tie = parseInt(set.p1Tiebreak);
                                    const p2Tie = parseInt(set.p2Tiebreak);
                                    if (p1Score === 7) p1Sets++;
                                    else if (p2Score === 7) p2Sets++;
                                }
                            } else {
                                // Regular set
                                if (p1Score > p2Score) p1Sets++;
                                else if (p2Score > p1Score) p2Sets++;
                            }
                        }
                    });

                    if (p1Sets >= 2) return player1?.id;
                    if (p2Sets >= 2) return player2?.id;
                    return null;
                };

                const updateSet = (setIndex, field, value) => {
                    const newSets = [...scoreData.sets];
                    newSets[setIndex][field] = value;
                    
                    // Check if this is a 10-point tiebreak scenario
                    if (field === 'p1' || field === 'p2') {
                        const p1Score = parseInt(newSets[setIndex].p1 || 0);
                        const p2Score = parseInt(newSets[setIndex].p2 || 0);
                        newSets[setIndex].isTenPointTiebreak = isTenPointTiebreakSet(p1Score, p2Score);
                        
                        // Clear tiebreak scores if not needed
                        if (!needsTiebreak(p1Score, p2Score) && !newSets[setIndex].isTenPointTiebreak) {
                            newSets[setIndex].p1Tiebreak = '';
                            newSets[setIndex].p2Tiebreak = '';
                        }
                    }
                    
                    const winnerId = calculateWinner();
                    setScoreData({ sets: newSets, winnerId });
                };

                const isValidScore = () => {
                    let completedSets = 0;
                    for (let set of scoreData.sets) {
                        if (set.p1 && set.p2) {
                            const p1 = parseInt(set.p1);
                            const p2 = parseInt(set.p2);
                            
                            if (set.isTenPointTiebreak) {
                                // 10-point tiebreak needs tiebreak scores
                                if (set.p1Tiebreak && set.p2Tiebreak) {
                                    completedSets++;
                                }
                            } else if (needsTiebreak(p1, p2)) {
                                // 7-6 or 6-7 needs tiebreak scores
                                if (set.p1Tiebreak && set.p2Tiebreak) {
                                    completedSets++;
                                }
                            } else if (p1 >= 0 && p2 >= 0) {
                                // Regular set
                                completedSets++;
                            }
                        }
                    }
                    return completedSets >= 2 && scoreData.winnerId;
                };

                const submitScore = () => {
                    if (!isValidScore()) {
                        alert('Please enter a valid match score (at least 2 sets completed with all required tiebreak scores)');
                        return;
                    }

                    // Create match record
                    const newMatch = {
                        id: matches.length + 1,
                        player1Id: currentMatch.player1Id,
                        player2Id: currentMatch.player2Id,
                        winnerId: scoreData.winnerId,
                        score: formatScore(),
                        sets: scoreData.sets.filter(set => set.p1 && set.p2),
                        date: new Date().toISOString().split('T')[0],
                        reportedBy: currentUser.id
                    };

                    // Update matches
                    setMatches([...matches, newMatch]);

                    // Update player stats and rankings
                    updatePlayerStats(newMatch);

                    // Remove completed challenge - FIXED BUG
                    if (currentMatch.challengeId) {
                        setChallenges(prev => prev.filter(c => c.id !== currentMatch.challengeId));
                    }

                    alert('Score reported successfully! Rankings updated.');
                    setCurrentView(currentUser.role === 'admin' ? 'admin-dashboard' : 'player-dashboard');
                };

                const formatScore = () => {
                    return scoreData.sets
                        .filter(set => set.p1 && set.p2)
                        .map(set => {
                            const p1 = parseInt(set.p1);
                            const p2 = parseInt(set.p2);
                            
                            if (set.isTenPointTiebreak && set.p1Tiebreak && set.p2Tiebreak) {
                                // 10-point tiebreak: show loser's score in parentheses
                                const p1Tie = parseInt(set.p1Tiebreak);
                                const p2Tie = parseInt(set.p2Tiebreak);
                                const loserScore = p1 === 1 ? p2Tie : p1Tie; // Winner has 1, loser has 0
                                return `${set.p1}-${set.p2} (${loserScore})`;
                            } else if (needsTiebreak(p1, p2) && set.p1Tiebreak && set.p2Tiebreak) {
                                // Regular tiebreak: show loser's score in parentheses
                                const p1Tie = parseInt(set.p1Tiebreak);
                                const p2Tie = parseInt(set.p2Tiebreak);
                                const loserScore = p1 === 7 ? p2Tie : p1Tie; // Winner has 7, loser has 6
                                return `${set.p1}-${set.p2} (${loserScore})`;
                            } else {
                                return `${set.p1}-${set.p2}`;
                            }
                        })
                        .join(', ');
                };

                const updatePlayerStats = (match) => {
                    const updatedPlayers = players.map(player => {
                        if (player.id === match.player1Id || player.id === match.player2Id) {
                            const isWinner = player.id === match.winnerId;
                            return {
                                ...player,
                                matches: player.matches + 1,
                                wins: player.wins + (isWinner ? 1 : 0),
                                losses: player.losses + (isWinner ? 0 : 1),
                                points: player.points + (isWinner ? 5 : 2) // Basic points system
                            };
                        }
                        return player;
                    });

                    // Handle ranking changes if challenger won
                    if (match.winnerId === match.player1Id) { // Challenger won
                        const challenger = updatedPlayers.find(p => p.id === match.player1Id);
                        const challenged = updatedPlayers.find(p => p.id === match.player2Id);
                        
                        if (challenger && challenged && challenger.ranking > challenged.ranking) {
                            // Swap rankings
                            const temp = challenger.ranking;
                            challenger.ranking = challenged.ranking;
                            challenged.ranking = temp;
                        }
                    }

                    setPlayers(updatedPlayers);
                };

                return (
                    <div className="min-h-screen bg-gray-50">
                        <div className="bg-white shadow-sm border-b">
                            <div className="px-4 py-3 flex justify-between items-center">
                                <h1 className="text-xl font-bold text-gray-900">Report Match Score</h1>
                                <button
                                    onClick={() => setCurrentView(currentUser?.role === 'admin' ? 'admin-dashboard' : 'player-dashboard')}
                                    className="text-gray-600 hover:text-gray-800"
                                >
                                    Cancel
                                </button>
                            </div>
                        </div>
                        
                        <div className="p-4">
                            <div className="bg-white rounded-lg shadow p-6 max-w-2xl mx-auto">
                                <div className="text-center mb-6">
                                    <h2 className="text-lg font-semibold text-gray-900 mb-2">Match Score Entry</h2>
                                    <div className="text-2xl font-bold text-green-600 mb-4">
                                        {player1?.name} vs {player2?.name}
                                    </div>
                                    <div className="text-sm text-gray-600">
                                        Rank #{player1?.ranking} vs Rank #{player2?.ranking}
                                    </div>
                                </div>

                                <div className="space-y-6">
                                    <div className="bg-gray-50 p-4 rounded-lg">
                                        <h3 className="font-medium text-gray-900 mb-4">Enter Score by Sets</h3>
                                        
                                        {[0, 1, 2].map((setIndex) => {
                                            const set = scoreData.sets[setIndex];
                                            const p1Score = parseInt(set.p1 || 0);
                                            const p2Score = parseInt(set.p2 || 0);
                                            const showTiebreak = needsTiebreak(p1Score, p2Score) || set.isTenPointTiebreak;
                                            
                                            return (
                                                <div key={setIndex} className="mb-6 p-3 border border-gray-200 rounded-lg">
                                                    <div className="flex items-center justify-center space-x-4 mb-3">
                                                        <div className="text-sm font-medium text-gray-700 w-16">
                                                            Set {setIndex + 1}:
                                                        </div>
                                                        
                                                        <div className="flex items-center space-x-2">
                                                            <div className="text-sm text-gray-600 w-20 text-right">
                                                                {player1?.name}
                                                            </div>
                                                            <input
                                                                type="number"
                                                                min="0"
                                                                max="7"
                                                                value={set.p1}
                                                                onChange={(e) => updateSet(setIndex, 'p1', e.target.value)}
                                                                className="w-16 px-3 py-2 border border-gray-300 rounded-lg text-center focus:ring-2 focus:ring-green-500"
                                                                placeholder="0"
                                                            />
                                                            
                                                            <span className="text-gray-500 font-medium">-</span>
                                                            
                                                            <input
                                                                type="number"
                                                                min="0"
                                                                max="7"
                                                                value={set.p2}
                                                                onChange={(e) => updateSet(setIndex, 'p2', e.target.value)}
                                                                className="w-16 px-3 py-2 border border-gray-300 rounded-lg text-center focus:ring-2 focus:ring-green-500"
                                                                placeholder="0"
                                                            />
                                                            
                                                            <div className="text-sm text-gray-600 w-20">
                                                                {player2?.name}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    {showTiebreak && (
                                                        <div className="mt-3">
                                                            <div className="text-xs text-gray-600 text-center mb-2">
                                                                {set.isTenPointTiebreak ? '10-Point Tiebreak - Enter both scores' : 'Tiebreak - Enter both scores'}
                                                            </div>
                                                            <div className="flex items-center justify-center space-x-2">
                                                                <div className="text-sm text-gray-600 w-20 text-right">
                                                                    {player1?.name}:
                                                                </div>
                                                                <input
                                                                    type="number"
                                                                    min="0"
                                                                    value={set.p1Tiebreak}
                                                                    onChange={(e) => updateSet(setIndex, 'p1Tiebreak', e.target.value)}
                                                                    className="w-16 px-3 py-1 border border-gray-300 rounded text-center text-sm focus:ring-2 focus:ring-green-500"
                                                                    placeholder="0"
                                                                />
                                                                
                                                                <span className="text-gray-500">-</span>
                                                                
                                                                <input
                                                                    type="number"
                                                                    min="0"
                                                                    value={set.p2Tiebreak}
                                                                    onChange={(e) => updateSet(setIndex, 'p2Tiebreak', e.target.value)}
                                                                    className="w-16 px-3 py-1 border border-gray-300 rounded text-center text-sm focus:ring-2 focus:ring-green-500"
                                                                    placeholder="0"
                                                                />
                                                                
                                                                <div className="text-sm text-gray-600 w-20">
                                                                    :{player2?.name}
                                                                </div>
                                                            </div>
                                                            <div className="text-xs text-gray-500 text-center mt-1">
                                                                Score will show loser's points in parentheses
                                                            </div>
                                                        </div>
                                                    )}
                                                </div>
                                            );
                                        })}
                                    </div>

                                    {formatScore() && (
                                        <div className="bg-blue-50 p-4 rounded-lg text-center">
                                            <div className="text-sm text-gray-600 mb-1">Current Score:</div>
                                            <div className="text-lg font-bold text-blue-800">{formatScore()}</div>
                                            {scoreData.winnerId && (
                                                <div className="text-sm text-green-600 mt-2">
                                                    Winner: {players.find(p => p.id === scoreData.winnerId)?.name}
                                                </div>
                                            )}
                                        </div>
                                    )}

                                    <div className="flex space-x-4">
                                        <button
                                            onClick={() => setCurrentView(currentUser?.role === 'admin' ? 'admin-dashboard' : 'player-dashboard')}
                                            className="flex-1 bg-gray-600 text-white py-3 rounded-lg hover:bg-gray-700 transition duration-200"
                                        >
                                            Cancel
                                        </button>
                                        
                                        <button
                                            onClick={submitScore}
                                            disabled={!isValidScore()}
                                            className={`flex-1 py-3 rounded-lg transition duration-200 ${
                                                isValidScore() 
                                                    ? 'bg-green-600 text-white hover:bg-green-700' 
                                                    : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                            }`}
                                        >
                                            Submit Score
                                        </button>
                                    </div>
                                </div>

                                <div className="mt-6 text-xs text-gray-500 text-center">
                                    <p>• For 7-6 or 6-7 sets, enter both tiebreak scores</p>
                                    <p>• For 1-0 sets, enter both 10-point tiebreak scores</p>
                                    <p>• Score display shows loser's tiebreak score: 7-6 (5) = winner 7, loser 5</p>
                                    <p>• Examples: 6-4, 7-6 (5) OR 6-2, 1-6, 1-0 (12)</p>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const MatchHistoryView = () => {
                const userMatches = matches.filter(m => 
                    m.player1Id === currentUser?.id || m.player2Id === currentUser?.id
                );

                return (
                    <div className="min-h-screen bg-gray-50">
                        <div className="bg-white shadow-sm border-b">
                            <div className="px-4 py-3 flex justify-between items-center">
                                <h1 className="text-xl font-bold text-gray-900">Match History</h1>
                                <button
                                    onClick={() => setCurrentView('player-dashboard')}
                                    className="text-gray-600 hover:text-gray-800"
                                >
                                    Back
                                </button>
                            </div>
                        </div>
                        
                        <div className="p-4">
                            <div className="bg-white rounded-lg shadow overflow-hidden">
                                <div className="px-6 py-4 border-b border-gray-200">
                                    <h2 className="text-lg font-semibold text-gray-900">Your Recent Matches</h2>
                                </div>
                                
                                {userMatches.length === 0 ? (
                                    <div className="px-6 py-8 text-center">
                                        <div className="text-4xl mb-4">🎾</div>
                                        <p className="text-gray-500">No matches played yet</p>
                                        <button
                                            onClick={() => setCurrentView('challenge')}
                                            className="mt-4 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700"
                                        >
                                            Challenge Someone
                                        </button>
                                    </div>
                                ) : (
                                    <div className="divide-y divide-gray-200">
                                        {userMatches.map((match) => {
                                            const opponent = players.find(p => 
                                                p.id === (match.player1Id === currentUser?.id ? match.player2Id : match.player1Id)
                                            );
                                            const isWinner = match.winnerId === currentUser?.id;
                                            
                                            return (
                                                <div key={match.id} className="px-6 py-4">
                                                    <div className="flex items-center justify-between">
                                                        <div>
                                                            <div className={`text-sm font-medium ${isWinner ? 'text-green-600' : 'text-red-600'}`}>
                                                                {isWinner ? 'WIN' : 'LOSS'} vs {opponent?.name}
                                                            </div>
                                                            <div className="text-sm text-gray-900 font-mono">
                                                                {match.score}
                                                            </div>
                                                            <div className="text-sm text-gray-500">
                                                                {match.date}
                                                            </div>
                                                        </div>
                                                        
                                                        <div className={`px-3 py-1 rounded-full text-xs font-medium ${
                                                            isWinner ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                                        }`}>
                                                            {isWinner ? 'W' : 'L'}
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            const RegisterScreen = () => {
                const [formData, setFormData] = useState({
                    name: '',
                    email: '',
                    phone: '',
                    rating: ''
                });

                const handleRegister = () => {
                    if (formData.name && formData.email) {
                        const newPlayer = {
                            id: players.length + 1,
                            name: formData.name,
                            email: formData.email,
                            ranking: players.length + 1,
                            points: 0,
                            matches: 0,
                            wins: 0,
                            losses: 0,
                            active: true
                        };
                        setPlayers([...players, newPlayer]);
                        alert('Registration successful! You can now login.');
                        setCurrentView('login');
                    } else {
                        alert('Please fill in required fields.');
                    }
                };

                return (
                    <div className="min-h-screen bg-gray-50 py-8 px-4">
                        <div className="max-w-md mx-auto bg-white rounded-lg shadow p-6">
                            <h2 className="text-2xl font-bold text-gray-900 mb-6">Register for Ladder</h2>
                            
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Full Name *</label>
                                    <input 
                                        type="text" 
                                        value={formData.name}
                                        onChange={(e) => setFormData({...formData, name: e.target.value})}
                                        className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent" 
                                    />
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Email *</label>
                                    <input 
                                        type="email" 
                                        value={formData.email}
                                        onChange={(e) => setFormData({...formData, email: e.target.value})}
                                        className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent" 
                                    />
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                                    <input 
                                        type="tel" 
                                        value={formData.phone}
                                        onChange={(e) => setFormData({...formData, phone: e.target.value})}
                                        className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent" 
                                    />
                                </div>
                                
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">USTA Rating (Optional)</label>
                                    <select 
                                        value={formData.rating}
                                        onChange={(e) => setFormData({...formData, rating: e.target.value})}
                                        className="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                    >
                                        <option value="">Select Rating</option>
                                        <option value="3.0">3.0</option>
                                        <option value="3.5">3.5</option>
                                        <option value="4.0">4.0</option>
                                        <option value="4.5">4.5</option>
                                        <option value="5.0">5.0</option>
                                        <option value="5.5">5.5</option>
                                    </select>
                                </div>
                                
                                <button
                                    onClick={handleRegister}
                                    className="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition duration-200 font-medium"
                                >
                                    Register
                                </button>
                                
                                <button
                                    onClick={() => setCurrentView('login')}
                                    className="w-full text-gray-600 hover:text-gray-800"
                                >
                                    Back to Login
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            const AdminDashboard = () => (
                <div className="min-h-screen bg-gray-50">
                    <div className="bg-white shadow-sm border-b">
                        <div className="px-4 py-3 flex justify-between items-center">
                            <h1 className="text-xl font-bold text-gray-900">Admin Dashboard</h1>
                            <button
                                onClick={() => setCurrentView('login')}
                                className="text-gray-600 hover:text-gray-800"
                            >
                                Logout
                            </button>
                        </div>
                    </div>
                    
                    <div className="p-4 space-y-4">
                        <div className="bg-white rounded-lg shadow p-4 mb-6">
                            <h2 className="text-lg font-semibold text-gray-900 mb-3">Ladder Overview</h2>
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div className="text-center">
                                    <div className="text-2xl font-bold text-green-600">{players.length}</div>
                                    <div className="text-sm text-gray-600">Active Players</div>
                                </div>
                                <div className="text-center">
                                    <div className="text-2xl font-bold text-blue-600">{challenges.length}</div>
                                    <div className="text-sm text-gray-600">Pending Challenges</div>
                                </div>
                                <div className="text-center">
                                    <div className="text-2xl font-bold text-purple-600">{challenges.filter(c => c.status === 'accepted').length}</div>
                                    <div className="text-sm text-gray-600">Matches Scheduled</div>
                                </div>
                                <div className="text-center">
                                    <div className="text-2xl font-bold text-yellow-600">12</div>
                                    <div className="text-sm text-gray-600">Weeks Remaining</div>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <AdminCard
                                icon="🏆"
                                title="View Ladder Rankings"
                                description="See current player rankings"
                                onClick={() => setCurrentView('rankings')}
                            />
                            
                            <AdminCard
                                icon="🎯"
                                title="Outstanding Challenges"
                                description="View all pending challenges"
                                onClick={() => setCurrentView('challenges')}
                            />
                            
                            <AdminCard
                                icon="👥"
                                title="Manage Players"
                                description="Add/Edit players"
                                onClick={() => setCurrentView('manage-players')}
                            />
                            
                            <AdminCard
                                icon="⚙️"
                                title="Ladder Settings"
                                description="Configure ladder rules"
                                onClick={() => setCurrentView('settings')}
                            />
                            
                            <AdminCard
                                icon="👑"
                                title="Create Tournament"
                                description="Generate playoff brackets"
                                onClick={() => setCurrentView('tournament')}
                            />
                            
                            <AdminCard
                                icon="📧"
                                title="Email Players"
                                description="Send messages to players"
                                onClick={() => setCurrentView('email')}
                            />
                        </div>
                    </div>
                </div>
            );

            const AdminCard = ({ icon, title, description, onClick }) => (
                <div
                    onClick={onClick}
                    className="bg-white rounded-lg shadow p-6 hover:shadow-md transition duration-200 cursor-pointer border border-gray-200"
                >
                    <div className="flex items-center mb-3">
                        <span className="text-2xl mr-3">{icon}</span>
                        <h3 className="text-lg font-medium text-gray-900">{title}</h3>
                    </div>
                    <p className="text-gray-600">{description}</p>
                </div>
            );

            const PlayerDashboard = () => {
                const currentPlayerData = players.find(p => p.id === currentUser?.id);
                const currentPlayerRanking = currentPlayerData?.ranking || 0;
                const playerChallenges = challenges.filter(c => 
                    c.challengerId === currentUser?.id || c.challengedId === currentUser?.id
                );

                return (
                    <div className="min-h-screen bg-gray-50">
                        <div className="bg-white shadow-sm border-b">
                            <div className="px-4 py-3 flex justify-between items-center">
                                <h1 className="text-xl font-bold text-gray-900">Player Dashboard</h1>
                                <button
                                    onClick={() => setCurrentView('login')}
                                    className="text-gray-600 hover:text-gray-800"
                                >
                                    Logout
                                </button>
                            </div>
                        </div>
                        
                        <div className="p-4 space-y-6">
                            <div className="bg-white rounded-lg shadow p-6">
                                <h2 className="text-lg font-semibold text-gray-900 mb-4">Your Status</h2>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    <div className="text-center">
                                        <div className="text-2xl font-bold text-green-600">#{currentPlayerRanking}</div>
                                        <div className="text-sm text-gray-600">Current Rank</div>
                                    </div>
                                    <div className="text-center">
                                        <div className="text-2xl font-bold text-blue-600">{currentPlayerData?.points || 0}</div>
                                        <div className="text-sm text-gray-600">Points</div>
                                    </div>
                                    <div className="text-center">
                                        <div className="text-2xl font-bold text-purple-600">{currentPlayerData?.matches || 0}</div>
                                        <div className="text-sm text-gray-600">Matches</div>
                                    </div>
                                    <div className="text-center">
                                        <div className="text-2xl font-bold text-yellow-600">
                                            {currentPlayerData?.matches > 0 ? Math.round((currentPlayerData.wins / currentPlayerData.matches) * 100) : 0}%
                                        </div>
                                        <div className="text-sm text-gray-600">Win Rate</div>
                                    </div>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <PlayerCard
                                    icon="🎯"
                                    title="Challenge Player"
                                    description="Challenge someone above you"
                                    onClick={() => setCurrentView('challenge')}
                                />
                                
                                <PlayerCard
                                    icon="🏆"
                                    title="View Rankings"
                                    description="See current ladder standings"
                                    onClick={() => setCurrentView('rankings')}
                                />
                                
                                <PlayerCard
                                    icon="⏰"
                                    title="My Challenges"
                                    description={`${playerChallenges.length} active challenges`}
                                    onClick={() => setCurrentView('my-challenges')}
                                />
                                
                                <PlayerCard
                                    icon="⭐"
                                    title="Match History"
                                    description="View your past matches"
                                    onClick={() => setCurrentView('match-history')}
                                />
                            </div>
                        </div>
                    </div>
                );
            };

            const PlayerCard = ({ icon, title, description, onClick }) => (
                <div
                    onClick={onClick}
                    className="bg-white rounded-lg shadow p-6 hover:shadow-md transition duration-200 cursor-pointer border border-gray-200"
                >
                    <div className="flex items-center mb-3">
                        <span className="text-2xl mr-3">{icon}</span>
                        <h3 className="text-lg font-medium text-gray-900">{title}</h3>
                    </div>
                    <p className="text-gray-600">{description}</p>
                </div>
            );

            const RankingsView = () => (
                <div className="min-h-screen bg-gray-50">
                    <div className="bg-white shadow-sm border-b">
                        <div className="px-4 py-3 flex justify-between items-center">
                            <h1 className="text-xl font-bold text-gray-900">Ladder Rankings</h1>
                            <button
                                onClick={() => setCurrentView(currentUser?.role === 'admin' ? 'admin-dashboard' : 'player-dashboard')}
                                className="text-gray-600 hover:text-gray-800"
                            >
                                Back
                            </button>
                        </div>
                    </div>
                    
                    <div className="p-4">
                        <div className="bg-white rounded-lg shadow overflow-hidden">
                            <div className="px-6 py-4 border-b border-gray-200">
                                <h2 className="text-lg font-semibold text-gray-900">Current Standings</h2>
                            </div>
                            
                            <div className="divide-y divide-gray-200">
                                {players.map((player, index) => (
                                    <div key={player.id} className="px-6 py-4 flex items-center justify-between">
                                        <div className="flex items-center">
                                            <div className={`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${
                                                player.ranking <= 3 ? 'bg-yellow-100' : 'bg-green-100'
                                            }`}>
                                                <span className={`text-sm font-semibold ${
                                                    player.ranking <= 3 ? 'text-yellow-800' : 'text-green-800'
                                                }`}>
                                                    #{player.ranking}
                                                </span>
                                            </div>
                                            <div className="ml-4">
                                                <div className="text-sm font-medium text-gray-900">
                                                    {player.name}
                                                    {player.id === currentUser?.id && (
                                                        <span className="ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">You</span>
                                                    )}
                                                </div>
                                                <div className="text-sm text-gray-500">{player.points} points</div>
                                            </div>
                                        </div>
                                        
                                        <div className="text-right">
                                            <div className="text-sm text-gray-900">{player.wins}-{player.losses}</div>
                                            <div className="text-sm text-gray-500">{player.matches} matches</div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );

            const ChallengesView = () => (
                <div className="min-h-screen bg-gray-50">
                    <div className="bg-white shadow-sm border-b">
                        <div className="px-4 py-3 flex justify-between items-center">
                            <h1 className="text-xl font-bold text-gray-900">Outstanding Challenges</h1>
                            <button
                                onClick={() => setCurrentView('admin-dashboard')}
                                className="text-gray-600 hover:text-gray-800"
                            >
                                Back
                            </button>
                        </div>
                    </div>
                    
                    <div className="p-4">
                        <div className="bg-white rounded-lg shadow overflow-hidden">
                            <div className="px-6 py-4 border-b border-gray-200">
                                <h2 className="text-lg font-semibold text-gray-900">Pending Challenges</h2>
                            </div>
                            
                            <div className="divide-y divide-gray-200">
                                {challenges.map((challenge) => {
                                    const challenger = players.find(p => p.id === challenge.challengerId);
                                    const challenged = players.find(p => p.id === challenge.challengedId);
                                    
                                    return (
                                        <div key={challenge.id} className="px-6 py-4">
                                            <div className="flex items-center justify-between">
                                                <div>
                                                    <div className="text-sm font-medium text-gray-900">
                                                        {challenger?.name} vs {challenged?.name}
                                                    </div>
                                                    <div className="text-sm text-gray-500">
                                                        Rank #{challenger?.ranking} challenging #{challenged?.ranking}
                                                    </div>
                                                    <div className="text-sm text-gray-500">
                                                        Proposed: {challenge.date}
                                                    </div>
                                                </div>
                                                
                                                <div className="flex items-center">
                                                    <span className={`px-2 py-1 text-xs rounded-full ${
                                                        challenge.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                                                        challenge.status === 'accepted' ? 'bg-green-100 text-green-800' :
                                                        'bg-red-100 text-red-800'
                                                    }`}>
                                                        {challenge.status}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );

            const ChallengePlayerView = () => {
                const currentPlayerRanking = players.find(p => p.id === currentUser?.id)?.ranking || 999;
                const challengeablePlayers = players.filter(p => p.ranking < currentPlayerRanking);

                return (
                    <div className="min-h-screen bg-gray-50">
                        <div className="bg-white shadow-sm border-b">
                            <div className="px-4 py-3 flex justify-between items-center">
                                <h1 className="text-xl font-bold text-gray-900">Challenge a Player</h1>
                                <button
                                    onClick={() => setCurrentView('player-dashboard')}
                                    className="text-gray-600 hover:text-gray-800"
                                >
                                    Back
                                </button>
                            </div>
                        </div>
                        
                        <div className="p-4">
                            <div className="bg-white rounded-lg shadow p-6 mb-4">
                                <h2 className="text-lg font-semibold text-gray-900 mb-4">Players You Can Challenge</h2>
                                <p className="text-sm text-gray-600 mb-4">You can challenge players ranked above you.</p>
                                
                                {challengeablePlayers.length === 0 ? (
                                    <div className="text-center py-8">
                                        <div className="text-4xl mb-4">🏆</div>
                                        <p className="text-gray-500">You're already #1! Great job!</p>
                                    </div>
                                ) : (
                                    <div className="space-y-3">
                                        {challengeablePlayers.map((player) => {
                                            const existingChallenge = challenges.find(c => 
                                                c.challengerId === currentUser?.id && c.challengedId === player.id
                                            );

                                            return (
                                                <div key={player.id} className="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                                                    <div>
                                                        <div className="text-sm font-medium text-gray-900">#{player.ranking} {player.name}</div>
                                                        <div className="text-sm text-gray-500">{player.points} points</div>
                                                    </div>
                                                    
                                                    {existingChallenge ? (
                                                        <span className="text-sm text-yellow-600">Challenge Pending</span>
                                                    ) : (
                                                        <button
                                                            onClick={() => {
                                                                const newChallenge = {
                                                                    id: challenges.length + 1,
                                                                    challengerId: currentUser.id,
                                                                    challengedId: player.id,
                                                                    status: 'pending',
                                                                    date: new Date().toISOString().split('T')[0],
                                                                    ladderid: 1
                                                                };
                                                                setChallenges([...challenges, newChallenge]);
                                                                alert(`Challenge sent to ${player.name}!`);
                                                            }}
                                                            className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200"
                                                        >
                                                            Challenge
                                                        </button>
                                                    )}
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            const MyChallengesView = () => {
                const myChallenges = challenges.filter(c => 
                    c.challengerId === currentUser?.id || c.challengedId === currentUser?.id
                );

                return (
                    <div className="min-h-screen bg-gray-50">
                        <div className="bg-white shadow-sm border-b">
                            <div className="px-4 py-3 flex justify-between items-center">
                                <h1 className="text-xl font-bold text-gray-900">My Challenges</h1>
                                <button
                                    onClick={() => setCurrentView('player-dashboard')}
                                    className="text-gray-600 hover:text-gray-800"
                                >
                                    Back
                                </button>
                            </div>
                        </div>
                        
                        <div className="p-4">
                            <div className="bg-white rounded-lg shadow overflow-hidden">
                                <div className="px-6 py-4 border-b border-gray-200">
                                    <h2 className="text-lg font-semibold text-gray-900">Active Challenges</h2>
                                </div>
                                
                                {myChallenges.length === 0 ? (
                                    <div className="px-6 py-8 text-center">
                                        <div className="text-4xl mb-4">⏰</div>
                                        <p className="text-gray-500">No active challenges</p>
                                        <button
                                            onClick={() => setCurrentView('challenge')}
                                            className="mt-4 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700"
                                        >
                                            Challenge Someone
                                        </button>
                                    </div>
                                ) : (
                                    <div className="divide-y divide-gray-200">
                                        {myChallenges.map((challenge) => {
                                            const challenger = players.find(p => p.id === challenge.challengerId);
                                            const challenged = players.find(p => p.id === challenge.challengedId);
                                            const isChallenger = challenge.challengerId === currentUser?.id;
                                            
                                            return (
                                                <div key={challenge.id} className="px-6 py-4">
                                                    <div className="flex items-center justify-between">
                                                        <div>
                                                            <div className="text-sm font-medium text-gray-900">
                                                                {isChallenger ? `You challenged ${challenged?.name}` : `${challenger?.name} challenged you`}
                                                            </div>
                                                            <div className="text-sm text-gray-500">
                                                                Proposed: {challenge.date}
                                                            </div>
                                                            <div className="text-sm text-gray-500">
                                                                Rank #{challenger?.ranking} vs #{challenged?.ranking}
                                                            </div>
                                                        </div>
                                                        
                                                        <div className="flex items-center space-x-2">
                                                            {challenge.status === 'pending' && !isChallenger && (
                                                                <>
                                                                    <button
                                                                        onClick={() => {
                                                                            setChallenges(challenges.map(c => 
                                                                                c.id === challenge.id ? {...c, status: 'accepted'} : c
                                                                            ));
                                                                            alert('Challenge accepted! You can now schedule your match.');
                                                                        }}
                                                                        className="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700"
                                                                    >
                                                                        Accept
                                                                    </button>
                                                                    <button
                                                                        onClick={() => {
                                                                            setChallenges(challenges.filter(c => c.id !== challenge.id));
                                                                            alert('Challenge declined.');
                                                                        }}
                                                                        className="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700"
                                                                    >
                                                                        Decline
                                                                    </button>
                                                                </>
                                                            )}
                                                            
                                                            {challenge.status === 'accepted' && (
                                                                <button
                                                                    onClick={() => setCurrentView('report-score')}
                                                                    className="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700"
                                                                >
                                                                    Report Score
                                                                </button>
                                                            )}
                                                            
                                                            {challenge.status === 'pending' && isChallenger && (
                                                                <button
                                                                    onClick={() => {
                                                                        setChallenges(challenges.filter(c => c.id !== challenge.id));
                                                                        alert('Challenge withdrawn.');
                                                                    }}
                                                                    className="bg-gray-600 text-white px-3 py-1 rounded text-sm hover:bg-gray-700"
                                                                >
                                                                    Withdraw
                                                                </button>
                                                            )}
                                                            
                                                            <span className={`px-2 py-1 text-xs rounded-full ${
                                                                challenge.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                                                                challenge.status === 'accepted' ? 'bg-green-100 text-green-800' :
                                                                'bg-red-100 text-red-800'
                                                            }`}>
                                                                {challenge.status}
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            const ManagePlayersView = () => (
                <div className="min-h-screen bg-gray-50">
                    <div className="bg-white shadow-sm border-b">
                        <div className="px-4 py-3 flex justify-between items-center">
                            <h1 className="text-xl font-bold text-gray-900">Manage Players</h1>
                            <button
                                onClick={() => setCurrentView('admin-dashboard')}
                                className="text-gray-600 hover:text-gray-800"
                            >
                                Back
                            </button>
                        </div>
                    </div>
                    
                    <div className="p-4">
                        <div className="bg-white rounded-lg shadow p-6 mb-4">
                            <div className="flex justify-between items-center mb-4">
                                <h2 className="text-lg font-semibold text-gray-900">Player Management</h2>
                                <button
                                    onClick={() => setCurrentView('add-player')}
                                    className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center"
                                >
                                    <span className="mr-2">➕</span>
                                    Add Player
                                </button>
                            </div>
                            
                            <div className="space-y-3">
                                {players.map((player) => (
                                    <div key={player.id} className="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                                        <div>
                                            <div className="text-sm font-medium text-gray-900">
                                                #{player.ranking} {player.name}
                                            </div>
                                            <div className="text-sm text-gray-500">
                                                {player.email} • {player.points} points • {player.matches} matches
                                            </div>
                                        </div>
                                        
                                        <div className="flex space-x-2">
                                            <button className="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">
                                                Edit
                                            </button>
                                            <button 
                                                onClick={() => {
                                                    if (confirm(`Remove ${player.name} from the ladder?`)) {
                                                        setPlayers(players.filter(p => p.id !== player.id));
                                                    }
                                                }}
                                                className="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700"
                                            >
                                                Remove
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );

            const renderCurrentView = () => {
                switch (currentView) {
                    case 'login':
                        return <LoginScreen />;
                    case 'register':
                        return <RegisterScreen />;
                    case 'admin-dashboard':
                        return <AdminDashboard />;
                    case 'player-dashboard':
                        return <PlayerDashboard />;
                    case 'rankings':
                        return <RankingsView />;
                    case 'challenges':
                        return <ChallengesView />;
                    case 'challenge':
                        return <ChallengePlayerView />;
                    case 'my-challenges':
                        return <MyChallengesView />;
                    case 'manage-players':
                        return <ManagePlayersView />;
                    case 'report-score':
                        return <ReportScoreView />;
                    case 'match-history':
                        return <MatchHistoryView />;
                    default:
                        return <LoginScreen />;
                }
            };

            return (
                <div className="min-h-screen bg-gray-50">
                    {renderCurrentView()}
                </div>
            );
        };

        ReactDOM.render(<TennisLadderApp />, document.getElementById('root'));
    </script>
</body>
</html>